#!/bin/sh
###########################################
##                                       ##
## FidoCadj 0.24.1 gamma                 ##
##                                       ##
## 2012-June-28 by Chokewood             ##
## revision juli 2 10:12:48 UTC 2012     ##
##                                       ##
###########################################

## file to open
file_open=$1
ext_in=`echo $file_open |awk -F . '{print $2}'`

if [ "$ext_in" == "fcd" ]
  then
    echo "Opening: $file_open"
  else
    file_open=" "
fi


run_app() {

  
  if [ ! -f $HOME/.fidocadj.cfg ]
  then
    # first run, create user config in its home folder
    cp /usr/share/fidocadj/default.template $HOME/.fidocadj.cfg
    sed -i '/#### DO NOT EDIT : TEMPLATE FOR USER .fidocadj.cfg ####/ d' $HOME/.fidocadj.cfg
    langcode=`env |grep -w LANG |cut -c6-7`
    echo "use_locale = $langcode" >> $HOME/.fidocadj.cfg
    echo "user .fidocadj.cfg created using: use_locale = $langcode"
  fi
  
  setlocale="-l`cat $HOME/.fidocadj.cfg |grep -w "use_locale" |awk '{print $3}'`"
  
  java_version=`java -version`
  if [ `env |grep JAVA |grep -c openjdk` -eq 1 ]
  then
	jdkopts=`cat $HOME/.fidocadj.cfg |grep -w openjdk |cut -c14-`
	export _JAVA_OPTIONS=$jdkopts
      else
	sunopts=`cat $HOME/.fidocadj.cfg |grep -w sun_oracle |cut -c14-`
	export _JAVA_OPTIONS=$sunopts
  fi

 echo "$java_version"
 $JAVA_HOME/bin/java -jar /usr/share/java/fidocadj/fidocadj.jar $setlocale $file_open
} # 

give_help() {
$JAVA_HOME/bin/java -jar /usr/share/java/fidocadj/fidocadj.jar -h
}



# HELP, --help, or -h
case "$1" in
        --help )
		give_help
    exit 0
  ;;

	-h )
	      give_help
    exit 0
  ;;

*) 
  run_app
  exit 0
   ;;
esac  

